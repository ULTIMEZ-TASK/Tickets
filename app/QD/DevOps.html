<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Responsibility SOP Dashboard</title>
    <style>
        :root {
            /* Light Theme (Default) */
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #334155;
            --text-muted: #64748b;
            --header-bg: #0f172a;
            --header-text: #ffffff;
            --border-color: #e2e8f0;
            --success-bg: #dcfce7;
            --success-text: #166534;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;
            --progress-bg: #e2e8f0;
            --progress-fill: #10b981;
            --auto-bg: #ede9fe;
            --auto-text: #5b21b6;
            --hover-bg: #f1f5f9;
        }

        /* Dark Theme Variables */
        body.dark-theme {
            --primary-color: #3b82f6;
            --secondary-color: #60a5fa;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #e2e8f0;
            --text-muted: #94a3b8;
            --header-bg: #020617; /* Darker header */
            --header-text: #f8fafc;
            --border-color: #334155;
            --success-bg: #064e3b;
            --success-text: #4ade80;
            --danger-bg: #7f1d1d;
            --danger-text: #f87171;
            --progress-bg: #334155;
            --progress-fill: #34d399;
            --auto-bg: #312e81;
            --auto-text: #a78bfa;
            --hover-bg: #334155;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        h1 {
            text-align: center;
            color: var(--text-color); /* Changed from header-bg for dark mode support */
            margin-bottom: 10px;
            font-size: 2rem;
        }

        p.subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 40px;
        }

        /* Dashboard Container */
        .dashboard-container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--card-bg);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        /* Control Bar */
        .control-bar {
            max-width: 1100px;
            margin: 0 auto 20px auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group label {
            font-weight: 600; 
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .control-group select, .control-group input {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-color);
            background-color: var(--bg-color);
        }
        
        .control-group input {
            width: 180px;
        }

        /* Buttons */
        .btn-reset {
            background-color: var(--danger-bg);
            color: var(--danger-text);
            border: 1px solid var(--danger-text);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.2s;
        }
        
        .btn-report {
            background-color: var(--success-bg);
            color: var(--success-text);
            border: 1px solid var(--success-text);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-theme {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-reset:hover, .btn-report:hover, .btn-theme:hover {
            opacity: 0.8;
        }

        /* Project Info Section */
        .project-info {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--card-bg);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 15px;
        }
        
        .info-card {
            background-color: var(--bg-color);
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .info-card h3 {
            margin: 0 0 8px 0;
            color: var(--secondary-color);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.8rem;
            line-height: 1.3;
        }
        
        .info-label {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.75rem;
            flex-shrink: 0;
            margin-right: 10px;
        }
        
        .info-value {
            font-weight: 600;
            color: var(--text-color);
            text-align: right;
            word-break: break-word;
        }

        /* Main Table Styles */
        .main-table {
            width: 100%;
            border-collapse: collapse;
        }

        .main-table thead {
            background-color: var(--header-bg);
            color: var(--header-text);
        }

        .main-table th, .main-table td {
            padding: 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .main-table th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        .main-table tr:last-child td {
            border-bottom: none;
        }

        .main-table tr:hover {
            background-color: var(--hover-bg);
        }

        .category-cell {
            font-weight: 700;
            color: var(--secondary-color);
            font-size: 1.05rem;
        }

        /* Progress Bar */
        .mini-progress-container {
            width: 100%;
            background-color: var(--progress-bg);
            border-radius: 4px;
            height: 8px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .mini-progress-bar {
            height: 100%;
            background-color: var(--progress-fill);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Action Button */
        .btn-view {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: center;
        }

        .btn-view:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-action {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 4px 10px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-action:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-content {
            background: var(--card-bg);
            width: 95%;
            max-width: 1300px;
            max-height: 90vh;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
            color: var(--text-color);
        }

        .modal-header {
            padding: 15px 25px;
            background-color: var(--header-bg);
            color: var(--header-text);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header-left {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.2rem;
        }

        .modal-progress-bg {
            background: rgba(255,255,255,0.2);
            width: 200px;
            height: 6px;
            border-radius: 4px;
            overflow: hidden;
        }

        .modal-progress-fill {
            background: #4ade80;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .close-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            background-color: var(--card-bg);
        }
        
        .modal-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        
        .filter-select {
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 0.85rem;
        }

        /* Detail Table Styles */
        .detail-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .detail-table th {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-weight: 700;
            padding: 12px;
            border-bottom: 2px solid var(--border-color);
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.85rem;
        }

        .detail-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .detail-table tr:last-child td {
            border-bottom: none;
        }

        .task-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--success-text);
        }

        .completed-row {
            background-color: var(--success-bg);
        }
        
        .completed-row td {
            color: var(--text-muted);
        }

        .completed-row .task-desc {
            color: var(--success-text);
            font-weight: 700;
        }

        .task-desc {
            font-weight: 600;
            display: block;
        }

        /* Tooltip Styles */
        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-top: 6px;
        }

        .task-meta {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background-color: var(--bg-color);
            border: 1px solid var(--success-text);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--success-text);
            font-weight: 600;
        }
        
        .task-meta strong {
            color: var(--text-color);
        }

        .tooltip-text {
            visibility: hidden;
            min-width: 200px;
            max-width: 300px;
            background-color: #1e293b;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 9999;
            top: 130%; 
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s, top 0.2s;
            font-weight: 400;
            font-size: 0.8rem;
            line-height: 1.4;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent #1e293b transparent;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            top: 115%;
        }

        .sub-header td {
            background-color: var(--border-color);
            color: var(--text-color);
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
            padding: 10px 12px;
        }

        .tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            white-space: normal;
            line-height: 1.2;
        }

        .tag-freq { background-color: var(--auto-bg); color: var(--auto-text); }
        .tag-auto { background-color: var(--progress-bg); color: var(--text-color); border: 1px solid var(--border-color); }
        .tag-manual { background-color: var(--danger-bg); color: var(--danger-text); }

        /* Dialog Styles */
        .dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .dialog-box {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            text-align: center;
            color: var(--text-color);
        }

        .dialog-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .dialog-input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 1rem;
            box-sizing: border-box;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-dialog {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-cancel { background: var(--bg-color); color: var(--text-muted); border: 1px solid var(--border-color); }
        .btn-confirm { background: var(--primary-color); color: white; }
        .btn-danger { background: var(--danger-bg); color: var(--danger-text); border: 1px solid var(--danger-text); }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .control-bar { flex-direction: column; align-items: stretch; }
            .main-table thead { display: none; }
            .main-table, .main-table tbody, .main-table tr, .main-table td { display: block; width: 100%; box-sizing: border-box; }
            .main-table tr { margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; }
            .modal-content { width: 100%; height: 100%; border-radius: 0; }
            .detail-table thead { display: none; }
            .detail-table, .detail-table tbody, .detail-table tr, .detail-table td { display: block; width: 100%; }
            .detail-table tr { margin-bottom: 1rem; border: 1px solid var(--border-color); padding: 10px; }
            .detail-table td { padding: 5px 0; border: none; }
            .info-grid { grid-template-columns: 1fr; }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <h1>DevOps Functional Dashboard</h1>
    <p class="subtitle">Interactive SOP Tracker for Solo Maintainer</p>

    <div class="control-bar">
        <!-- Theme Toggle -->
        <button class="btn-theme" onclick="toggleTheme()" title="Toggle Dark Mode">
            <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>

        <div class="control-group">
            <label for="projectSelect">Project:</label>
            <select id="projectSelect" onchange="switchProject(this.value)">
                <option value="coinpedia">CoinPedia</option>
                <option value="ultimez">ULTIMEZ</option>
            </select>
        </div>

        <div class="control-group">
            <label for="devopsName">Name:</label>
            <select id="devopsName" onchange="saveName(this.value)">
                <option value="">Select Employee</option>
                <option value="QD">QD</option>
                <option value="Aftab">Aftab</option>
                <option value="Hajresaab">Hajresaab</option>
            </select>
        </div>

        <div style="flex-grow: 1;"></div>

        <button class="btn-report" onclick="generateReport()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
            Copy Report
        </button>

        <button class="btn-reset" onclick="openResetDialog()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74-2.74L3 12"/></svg>
            Reset Daily
        </button>
    </div>

    <!-- Project Details Section -->
    <div class="dashboard-container" id="projectDetailsPanel">
        <div class="project-info">
            <div class="info-grid">
                <!-- Environment Info -->
                <div class="info-card">
                    <h3>Environment & Hosting</h3>
                    <div class="info-item"><span class="info-label">Production Env:</span> <span class="info-value" id="info-prod">-</span></div>
                    <div class="info-item"><span class="info-label">Staging/Preview:</span> <span class="info-value" id="info-stage">-</span></div>
                    <div class="info-item"><span class="info-label">Domain:</span> <span class="info-value" id="info-domain">-</span></div>
                    <div class="info-item"><span class="info-label">CDN / Storage:</span> <span class="info-value" id="info-cdn">-</span></div>
                </div>

                <!-- Tech Stack Info -->
                <div class="info-card">
                    <h3>Technology Stack</h3>
                    <div class="info-item"><span class="info-label">Frontend:</span> <span class="info-value" id="info-fe">-</span></div>
                    <div class="info-item"><span class="info-label">Backend:</span> <span class="info-value" id="info-be">-</span></div>
                    <div class="info-item"><span class="info-label">Database:</span> <span class="info-value" id="info-db">-</span></div>
                    <div class="info-item"><span class="info-label">CI/CD:</span> <span class="info-value" id="info-ci">-</span></div>
                </div>

                <!-- Tools Info -->
                <div class="info-card">
                    <h3>Monitoring & Tools</h3>
                    <div class="info-item"><span class="info-label">Observability:</span> <span class="info-value" id="info-obs">-</span></div>
                    <div class="info-item"><span class="info-label">UX Analytics:</span> <span class="info-value" id="info-ux">-</span></div>
                    <div class="info-item"><span class="info-label">SEO Tools:</span> <span class="info-value" id="info-seo">-</span></div>
                    <div class="info-item"><span class="info-label">API Gateway:</span> <span class="info-value" id="info-api">-</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <table class="main-table">
            <thead>
                <tr>
                    <th style="width: 5%">#</th>
                    <th style="width: 35%">Process Category</th>
                    <th style="width: 35%">Progress</th>
                    <th style="width: 25%">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td class="category-cell">Pipeline Setup Process</td>
                    <td>
                        <div class="mini-progress-container">
                            <div id="prog-pipeline" class="mini-progress-bar"></div>
                        </div>
                        <small id="text-pipeline" style="color: var(--text-muted);">0% Complete</small>
                    </td>
                    <td><button class="btn-view" onclick="openModal('pipeline')">Manage & Track</button></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td class="category-cell">Ticket Deploy & Monitoring</td>
                    <td>
                        <div class="mini-progress-container">
                            <div id="prog-ticket" class="mini-progress-bar"></div>
                        </div>
                        <small id="text-ticket" style="color: var(--text-muted);">0% Complete</small>
                    </td>
                    <td><button class="btn-view" onclick="openModal('ticket')">Manage & Track</button></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td class="category-cell">Infrastructure Management</td>
                    <td>
                        <div class="mini-progress-container">
                            <div id="prog-infra" class="mini-progress-bar"></div>
                        </div>
                        <small id="text-infra" style="color: var(--text-muted);">0% Complete</small>
                    </td>
                    <td><button class="btn-view" onclick="openModal('infra')">Manage & Track</button></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td class="category-cell">Application Management</td>
                    <td>
                        <div class="mini-progress-container">
                            <div id="prog-app" class="mini-progress-bar"></div>
                        </div>
                        <small id="text-app" style="color: var(--text-muted);">0% Complete</small>
                    </td>
                    <td><button class="btn-view" onclick="openModal('app')">Manage & Track</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- MAIN SOP POPUP MODAL -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-left">
                    <h2 id="modalTitle">Process Details</h2>
                    <div class="modal-progress-bg">
                        <div id="modalProgressBar" class="modal-progress-fill"></div>
                    </div>
                </div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-controls">
                    <select id="taskFilter" class="filter-select" onchange="filterTasks()">
                        <option value="all">Show All Tasks</option>
                        <option value="daily">Show Daily Tasks Only</option>
                        <option value="pending">Show Pending Only</option>
                    </select>
                </div>
                <div id="modalTableContainer">
                    <!-- Table injected via JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- DIALOGS -->
    <div id="taskDialog" class="dialog-overlay">
        <div class="dialog-box">
            <div class="dialog-title">Complete Task</div>
            <p style="margin-bottom: 15px; color: var(--text-muted); font-size: 0.9rem;">Add a status note or comment (Optional)</p>
            <input type="text" id="taskCommentInput" class="dialog-input" placeholder="e.g. Fixed bug, CPU normal...">
            <div class="dialog-buttons">
                <button class="btn-dialog btn-cancel" onclick="closeTaskDialog()">Cancel</button>
                <button class="btn-dialog btn-confirm" onclick="confirmTaskCompletion()">Complete Task</button>
            </div>
        </div>
    </div>

    <div id="nameDialog" class="dialog-overlay">
        <div class="dialog-box">
            <div class="dialog-title">DevOps Name Required</div>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Please select your name to track this task.</p>
            <select id="nameInputModal" class="dialog-input">
                <option value="">Select Employee</option>
                <option value="QD">QD</option>
                <option value="Aftab">Aftab</option>
                <option value="Hajresaab">Hajresaab</option>
            </select>
            <div class="dialog-buttons">
                <button class="btn-dialog btn-cancel" onclick="closeNameDialog()">Cancel</button>
                <button class="btn-dialog btn-confirm" onclick="saveNameFromDialog()">Save Name</button>
            </div>
        </div>
    </div>

    <div id="resetDialog" class="dialog-overlay">
        <div class="dialog-box">
            <div class="dialog-title">Reset Daily Tasks?</div>
            <p style="margin-bottom: 20px; color: var(--text-muted);">Are you sure you want to uncheck all "Daily" tasks for the current project?</p>
            <div class="dialog-buttons">
                <button class="btn-dialog btn-cancel" onclick="closeResetDialog()">Cancel</button>
                <button class="btn-dialog btn-danger" onclick="confirmReset()">Yes, Reset Daily</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIG & DATA ---
        const projects = {
            coinpedia: {
                name: "CoinPedia",
                env: { prod: "Vercel (FE) + DigitalOcean (BE)", stage: "Vercel Preview + DO App Dev", domain: "coinpedia.org", cdn: "DigitalOcean Spaces" },
                stack: { fe: "Next.js (React)", be: "Node.js (Express/Nest)", db: "MongoDB Atlas", ci: "GitHub Actions" },
                tools: { obs: "New Relic", ux: "Microsoft Clarity", seo: "Google Search Console", api: "Google Cloud Platform" }
            },
            ultimez: {
                name: "ULTIMEZ",
                env: { prod: "DigitalOcean App Platform", stage: "DO Dev Container", domain: "ultimez.com", cdn: "AWS S3 / DO Spaces" },
                stack: { fe: "React.js / Next.js", be: "Node.js / Python", db: "PostgreSQL / MongoDB", ci: "GitLab CI / GitHub Actions" },
                tools: { obs: "Datadog / New Relic", ux: "Hotjar / Clarity", seo: "SEMrush / GSC", api: "AWS API Gateway" }
            }
        };

        const processes = {
            pipeline: {
                title: "1. Pipeline Setup Process",
                sections: [
                    { title: "Environment (Node/React)", tasks: [
                        { id: "p1", desc: "Docker Local Env", freq: "One-time", note: "Containerize Node.js API & Mongo", auto: "Yes (Docker)", link: "https://docs.docker.com/compose/", linkText: "Docs" },
                        { id: "p2", desc: "Vercel Preview Config", freq: "One-time", note: "Auto-deploy Next.js on PRs", auto: "Yes (Vercel)", link: "https://vercel.com/dashboard", linkText: "Vercel" },
                        { id: "p3", desc: "DO App Spec Config", freq: "Ad-hoc", note: "Update App Platform YAML", auto: "No", link: "https://cloud.digitalocean.com/apps", linkText: "DO App" }
                    ]},
                    { title: "Tech Stack (CI/CD)", tasks: [
                        { id: "p4", desc: "Node.js CI Pipeline", freq: "Per Push", note: "Github Actions: Lint, Test, Build", auto: "Yes (Actions)", link: "https://github.com/", linkText: "GitHub" },
                        { id: "p5", desc: "Container Registry", freq: "Ad-hoc", note: "Push Node.js Docker images to DO", auto: "Yes (Actions)", link: "https://cloud.digitalocean.com/registry", linkText: "Registry" }
                    ]},
                    { title: "3rd Party Secrets", tasks: [
                        { id: "p7", desc: "Sync GCP/API Keys", freq: "Ad-hoc", note: "Update Github Secrets & Vercel Env", auto: "No", link: "https://github.com/", linkText: "Secrets" }
                    ]}
                ]
            },
            ticket: {
                title: "2. Ticket Deploy & Monitoring Process",
                sections: [
                    { title: "Development", tasks: [
                        { id: "t1", desc: "Create Feature Branch", freq: "Per Ticket", note: "fix/auth-bug or feat/user-profile", auto: "No", link: "https://github.com/", linkText: "GitHub" },
                        { id: "t2", desc: "Verify Vercel Preview", freq: "Per PR", note: "Test Next.js UI on preview URL", auto: "No", link: "https://vercel.com/dashboard", linkText: "Vercel" }
                    ]},
                    { title: "Deployment (Production)", tasks: [
                        { id: "t3", desc: "Merge to Main", freq: "Per Ticket", note: "Triggers Vercel (FE) & DO App (BE)", auto: "Yes (Git)", link: "https://github.com/", linkText: "Merge PR" },
                        { id: "t4", desc: "Smoke Test APIs", freq: "Immediate", note: "Check Login/Location APIs", auto: "Yes (Alerts)", link: "https://one.newrelic.com", linkText: "New Relic" }
                    ]}
                ]
            },
            infra: {
                title: "3. Infrastructure Management Routine",
                sections: [
                    { title: "DigitalOcean (Via New Relic)", tasks: [
                        { id: "i1", desc: "Droplet: Monitor Disk Usage & Load", freq: "Daily", note: "Alert if >85% Scale if Necessary only", auto: "Yes (New Relic Infra)", link: "https://cloud.digitalocean.com/droplets", linkText: "Droplets" },
                        { id: "i2", desc: "App Platform: Check Deployment stability", freq: "Daily", note: "Monitor health checks", auto: "Yes (New Relic)", link: "https://cloud.digitalocean.com/apps", linkText: "Apps" },
                        { id: "i3", desc: "Databases: Check Connection counts", freq: "Weekly", note: "Monitor pool usage", auto: "Yes (New Relic)", link: "https://cloud.digitalocean.com/databases", linkText: "DBs" },
                        { id: "i4", desc: "Droplet: Apply OS security updates", freq: "Monthly", note: "Critical patches asap", auto: "Yes (Unattended Upgrades)", link: "https://cloud.digitalocean.com/droplets", linkText: "Console" },
                        { id: "i5", desc: "App Platform: Review build logs & failures", freq: "Daily", note: "Check recent commits", auto: "Yes (Slack/Email)", link: "https://cloud.digitalocean.com/apps", linkText: "Logs" },
                        { id: "i6", desc: "Active Connections", freq: "Daily", note: "Check connection limit", auto: "Yes", link: "#", linkText: "Monitor" },
                        { id: "i7", desc: "DB health & status", freq: "Daily", note: "Primary/replica status", auto: "Yes", link: "#", linkText: "DB Status" }
                    ]},
                    { title: "GCP (Google Cloud)", tasks: [
                        { id: "i8", desc: "BigQuery: Cost & Slot Usage Analysis", freq: "Weekly", note: "Optimize expensive queries", auto: "Yes (Billing Alerts)", link: "https://console.cloud.google.com/bigquery", linkText: "BigQuery" },
                        { id: "i9", desc: "APIs: Monitor Quota usage, Errors & Latency", freq: "Weekly", note: "Check Limits", auto: "Yes (GCP Alerts)", link: "https://console.cloud.google.com/apis/dashboard", linkText: "GCP APIs" }
                    ]},
                    { title: "Vercel", tasks: [
                        { id: "i10", desc: "Project: Review Build Logs for errors", freq: "Daily", note: "Check for build errors", auto: "Yes (Vercel Integration)", link: "https://vercel.com/dashboard", linkText: "Vercel" },
                        { id: "i11", desc: "Access Logs: Monitor 4xx/5xx", freq: "Daily", note: "Focus on Error fixing", auto: "No (Manual)", link: "https://vercel.com/dashboard/usage", linkText: "Logs" },
                        { id: "i12", desc: "Functions: Monitor Execution duration", freq: "Weekly", note: "Optimize serverless fns", auto: "Yes (New Relic)", link: "https://vercel.com/dashboard/usage", linkText: "Functions" }
                    ]},
                    { title: "MongoDB Atlas", tasks: [
                        { id: "i13", desc: "Clusters: Monitor CPU, IOPS, Connections", freq: "Daily", note: "Auto-scale if needed", auto: "Yes (Atlas Alerts)", link: "https://cloud.mongodb.com/", linkText: "Atlas" },
                        { id: "i14", desc: "Performance Advisor (Slow queries)", freq: "Monthly", note: "Add suggested indexes", auto: "No (Decision Req)", link: "https://cloud.mongodb.com/", linkText: "Advisor" },
                        { id: "i15", desc: "Security: Review DB Access", freq: "Quarterly", note: "Remove old devs/IPs", auto: "No (Manual)", link: "https://cloud.mongodb.com/", linkText: "Security" }
                    ]},
                    { title: "General", tasks: [
                        { id: "i16", desc: "Regular Backup (App & DB)", freq: "Weekly/On demand", note: "Have a Rollback plan", auto: "Yes (Auto Backup)", link: "#", linkText: "Backups" },
                        { id: "i17", desc: "Application Uptime monitor", freq: "Daily", note: "Check status pages", auto: "Yes", link: "https://betterstack.com/", linkText: "Uptime" }
                    ]}
                ]
            },
            app: {
                title: "4. Application Management Routine",
                sections: [
                    { title: "New Relic (Observability)", tasks: [
                        { id: "a1", desc: "APM: Review Error Rate & Traces", freq: "Daily", note: "Investigation needed if >1%", auto: "Yes (Alert Policies)", link: "https://one.newrelic.com", linkText: "APM" },
                        { id: "a2", desc: "Synthetics: Monitor API Uptime", freq: "Daily", note: "Check ping locations", auto: "Yes (Slack/Email)", link: "https://one.newrelic.com/synthetics", linkText: "Synthetics" },
                        { id: "a3", desc: "Browser: Core Web Vitals (LCP, CLS)", freq: "Weekly", note: "Performance optimization", auto: "Yes (Dashboards)", link: "https://one.newrelic.com/browser", linkText: "Browser" },
                        { id: "a4", desc: "Infra: Review Host CPU/RAM thresholds", freq: "Weekly", note: "Adjust alert thresholds", auto: "Yes (Infra Alerts)", link: "https://one.newrelic.com/infrastructure", linkText: "Infra" },
                        { id: "a5", desc: "Slow APIs and their Components", freq: "Daily", note: "Alerts on slow API Response", auto: "Yes (Investigate)", link: "https://one.newrelic.com", linkText: "APIs" }
                    ]},
                    { title: "Google Search Console (SEO)", tasks: [
                        { id: "a6", desc: "Check Pages for Indexing Errors (404/5xx)", freq: "Weekly", note: "Fix broken links/redirects", auto: "Yes (Email Digest)", link: "https://search.google.com/search-console", linkText: "GSC" },
                        { id: "a7", desc: "Review Performance (Clicks/Impressions)", freq: "Monthly", note: "Compare vs previous month", auto: "No (Manual)", link: "https://search.google.com/search-console/performance", linkText: "Performance" },
                        { id: "a8", desc: "Inspect URL for new critical pages", freq: "Ad-hoc", note: "Ensure rapid indexing", auto: "No", link: "https://search.google.com/search-console", linkText: "Inspect" }
                    ]},
                    { title: "Microsoft Clarity (UX)", tasks: [
                        { id: "a9", desc: "Review Rage Clicks & Dead Clicks", freq: "Weekly", note: "ID broken UI elements", auto: "No (Manual)", link: "https://clarity.microsoft.com/projects", linkText: "Clarity" },
                        { id: "a10", desc: "Watch Session Recordings", freq: "Weekly", note: "ID checkout/login friction", auto: "No", link: "https://clarity.microsoft.com/recordings", linkText: "Recordings" }
                    ]}
                ]
            }
        };

        // --- 2. STATE MANAGEMENT ---
        let currentProjectId = 'coinpedia';
        let taskState = {};
        let currentModalType = null;
        let pendingTaskType = null;
        let pendingTaskId = null;

        function switchProject(projectId) {
            currentProjectId = projectId;
            const data = projects[projectId];

            // Update UI Details
            document.getElementById('info-prod').textContent = data.env.prod;
            document.getElementById('info-stage').textContent = data.env.stage;
            document.getElementById('info-domain').textContent = data.env.domain;
            document.getElementById('info-cdn').textContent = data.env.cdn;
            
            document.getElementById('info-fe').textContent = data.stack.fe;
            document.getElementById('info-be').textContent = data.stack.be;
            document.getElementById('info-db').textContent = data.stack.db;
            document.getElementById('info-ci').textContent = data.stack.ci;
            
            document.getElementById('info-obs').textContent = data.tools.obs;
            document.getElementById('info-ux').textContent = data.tools.ux;
            document.getElementById('info-seo').textContent = data.tools.seo;
            document.getElementById('info-api').textContent = data.tools.api;

            taskState = JSON.parse(localStorage.getItem('devops_dashboard_state_' + projectId)) || {};
            updateAllProgress();
        }

        function saveName(name) {
            localStorage.setItem('devops_user_name', name);
        }

        // Initialize
        const savedName = localStorage.getItem('devops_user_name');
        if(savedName) document.getElementById('devopsName').value = savedName;
        
        // Dark Mode Init
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-theme');
        }

        document.getElementById('projectSelect').value = currentProjectId;
        switchProject(currentProjectId);

        // --- 3. MODAL LOGIC ---
        function openModal(type) {
            currentModalType = type;
            const data = processes[type];
            document.getElementById('modalTitle').innerText = data.title;
            renderModalTable();
            document.getElementById('modalOverlay').style.display = 'flex';
            updateModalProgress(type);
        }

        function renderModalTable() {
            if (!currentModalType) return;
            const data = processes[currentModalType];
            const filter = document.getElementById('taskFilter').value;
            
            let html = `<table class="detail-table">
                        <thead>
                            <tr>
                                <th style="width: 5%">Done</th>
                                <th style="width: 30%">Task Description</th>
                                <th style="width: 10%">Freq</th>
                                <th style="width: 25%">Note</th>
                                <th style="width: 20%">Automation?</th>
                                <th style="width: 10%">Action</th>
                            </tr>
                        </thead>
                        <tbody>`;

            data.sections.forEach(section => {
                let hasVisibleTasks = false;
                let sectionHtml = `<tr class="sub-header"><td colspan="6">${section.title}</td></tr>`;
                
                let tasksHtml = '';
                section.tasks.forEach(task => {
                    const taskData = taskState[task.id];
                    const isCompleted = taskData?.completed;
                    
                    // Filter Logic
                    if (filter === 'daily' && !task.freq.toLowerCase().includes('daily')) return;
                    if (filter === 'pending' && isCompleted) return;
                    
                    hasVisibleTasks = true;
                    const isChecked = isCompleted ? 'checked' : '';
                    const rowClass = isCompleted ? 'completed-row' : '';
                    
                    let metaInfo = '';
                    if(isCompleted) {
                        const commentIcon = taskData.comment ? ' ðŸ’¬' : '';
                        const tooltipHtml = taskData.comment ? `<span class="tooltip-text"><strong>Status/Comment:</strong><br>${taskData.comment}</span>` : '';
                        metaInfo = `
                            <div class="tooltip-container">
                                <span class="task-meta">âœ“ ${taskData.user} (${taskData.time})${commentIcon}</span>
                                ${tooltipHtml}
                            </div>`;
                    }
                    
                    const isAuto = task.auto.toLowerCase().includes('yes');
                    const autoClass = isAuto ? 'tag tag-auto' : 'tag tag-manual';
                    
                    tasksHtml += `
                        <tr class="${rowClass}" id="row-${task.id}">
                            <td style="text-align: center; vertical-align: top; padding-top: 20px;">
                                <input type="checkbox" id="checkbox-${task.id}" class="task-checkbox" 
                                    onclick="handleTaskClick(event, '${currentModalType}', '${task.id}')" ${isChecked}>
                            </td>
                            <td>
                                <span class="task-desc">${task.desc}</span>
                                <div id="info-${task.id}">${metaInfo}</div>
                            </td>
                            <td><span class="tag tag-freq">${task.freq}</span></td>
                            <td>${task.note}</td>
                            <td><span class="${autoClass}">${task.auto}</span></td>
                            <td><a href="${task.link}" target="_blank" class="btn-action">${task.linkText} &nearr;</a></td>
                        </tr>`;
                });

                if (hasVisibleTasks) {
                    html += sectionHtml + tasksHtml;
                }
            });

            html += `</tbody></table>`;
            document.getElementById('modalTableContainer').innerHTML = html;
        }

        function filterTasks() {
            renderModalTable();
        }

        // --- 4. TASK INTERACTION ---
        function handleTaskClick(event, type, taskId) {
            event.preventDefault(); 
            pendingTaskType = type;
            pendingTaskId = taskId;

            if (taskState[taskId]?.completed) {
                // Uncheck immediately
                delete taskState[taskId];
                saveState();
                renderModalTable(); // Re-render to update UI completely
                updateAllProgress();
                return;
            }

            let userName = document.getElementById('devopsName').value.trim();
            if (!userName) {
                document.getElementById('nameDialog').style.display = 'flex';
                document.getElementById('nameInputModal').focus();
                return;
            }

            openTaskDialog();
        }

        // --- 5. DIALOG HANDLERS ---
        function closeNameDialog() {
            document.getElementById('nameDialog').style.display = 'none';
            pendingTaskType = null;
            pendingTaskId = null;
        }

        function saveNameFromDialog() {
            const nameVal = document.getElementById('nameInputModal').value.trim();
            if(!nameVal) return;

            document.getElementById('devopsName').value = nameVal;
            saveName(nameVal);
            document.getElementById('nameDialog').style.display = 'none';
            openTaskDialog();
        }

        function openTaskDialog() {
            document.getElementById('taskCommentInput').value = ''; 
            document.getElementById('taskDialog').style.display = 'flex';
            document.getElementById('taskCommentInput').focus();
        }

        function closeTaskDialog() {
            document.getElementById('taskDialog').style.display = 'none';
            pendingTaskType = null;
            pendingTaskId = null;
        }

        function confirmTaskCompletion() {
            const userName = document.getElementById('devopsName').value.trim();
            const comment = document.getElementById('taskCommentInput').value.trim();
            
            // Format Date: "Mon 19, 10:45 AM"
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' });
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            const timestamp = `${dateStr}, ${timeStr}`;

            taskState[pendingTaskId] = {
                completed: true,
                user: userName,
                time: timestamp,
                comment: comment
            };

            saveState();
            renderModalTable();
            updateAllProgress();
            closeTaskDialog();
        }

        // --- 6. RESET LOGIC ---
        function openResetDialog() {
            document.getElementById('resetDialog').style.display = 'flex';
        }

        function closeResetDialog() {
            document.getElementById('resetDialog').style.display = 'none';
        }

        function confirmReset() {
            for (const key in processes) {
                processes[key].sections.forEach(sec => {
                    sec.tasks.forEach(task => {
                        if (task.freq.toLowerCase().includes("daily")) {
                            delete taskState[task.id];
                        }
                    });
                });
            }
            saveState();
            
            if(document.getElementById('modalOverlay').style.display === 'flex') {
                renderModalTable();
            }
            updateAllProgress();
            closeResetDialog();
        }

        // --- 7. UTILS & EXTRAS ---
        function saveState() {
            localStorage.setItem('devops_dashboard_state_' + currentProjectId, JSON.stringify(taskState));
        }

        function updateModalProgress(type) {
            const stats = calculateProgress(type);
            const percent = stats.total === 0 ? 0 : Math.round((stats.done / stats.total) * 100);
            document.getElementById('modalProgressBar').style.width = `${percent}%`;
        }

        function updateAllProgress() {
            for (const key in processes) {
                const stats = calculateProgress(key);
                const percent = stats.total === 0 ? 0 : Math.round((stats.done / stats.total) * 100);
                
                const bar = document.getElementById(`prog-${key}`);
                const text = document.getElementById(`text-${key}`);
                
                if(bar && text) {
                    bar.style.width = `${percent}%`;
                    text.innerText = `${percent}% Complete (${stats.done}/${stats.total})`;
                }
            }
        }

        function calculateProgress(type) {
            let total = 0;
            let done = 0;
            
            processes[type].sections.forEach(sec => {
                sec.tasks.forEach(task => {
                    total++;
                    if (taskState[task.id]?.completed) done++;
                });
            });

            return { total, done };
        }

        // Feature: Generate Report
        function generateReport() {
            let report = `DEVOPS REPORT - ${projects[currentProjectId].name.toUpperCase()}\n`;
            report += `Date: ${new Date().toLocaleDateString()}\n`;
            report += `User: ${document.getElementById('devopsName').value || 'Unknown'}\n`;
            report += `--------------------------------------------------\n\n`;

            let completedCount = 0;
            
            for (const key in processes) {
                const p = processes[key];
                const tasks = [];
                
                p.sections.forEach(sec => {
                    sec.tasks.forEach(task => {
                        if(taskState[task.id]?.completed) {
                            const t = taskState[task.id];
                            tasks.push(`[x] ${task.desc} \n    Time: ${t.time} | Note: ${t.comment || 'N/A'}`);
                            completedCount++;
                        }
                    });
                });

                if(tasks.length > 0) {
                    report += `### ${p.title}\n${tasks.join('\n')}\n\n`;
                }
            }

            report += `--------------------------------------------------\n`;
            report += `Total Completed: ${completedCount}\n`;

            // Copy to clipboard
            navigator.clipboard.writeText(report).then(() => {
                alert("Report copied to clipboard!");
            }).catch(err => {
                console.error("Clipboard failed", err);
                alert("Could not copy report. Check console.");
            });
        }

        // Feature: Dark Mode
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            currentModalType = null;
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('modalOverlay')) {
                closeModal();
            }
        }
        
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
                closeTaskDialog();
                closeNameDialog();
                closeResetDialog();
            }
        });
    </script>
</body>
</html>
